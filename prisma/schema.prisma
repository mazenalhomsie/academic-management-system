
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  relationMode = "prisma" // Recommended for serverless environments (PlanetScale, Vercel)
}

enum Role {
  STUDENT
  TEACHER
  ADMIN
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  role      Role     @default(STUDENT)
  avatar    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Role specific relations
  teacherProfile TeacherProfile?
  studentProfile StudentProfile?
  
  announcements Announcement[] @relation("PostedBy")

  @@index([email])
}

model StudentProfile {
  id         String @id @default(cuid())
  userId     String @unique
  user       User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  gradeLevel String
  gpa        Float  @default(0.0)
  
  grades     Grade[]

  @@index([userId])
}

model TeacherProfile {
  id         String @id @default(cuid())
  userId     String @unique
  user       User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  department String
  
  subjects   Subject[]

  @@index([userId])
}

model Subject {
  id        String   @id @default(cuid())
  name      String
  code      String   @unique
  schedule  String?
  
  teacherId String
  teacher   TeacherProfile @relation(fields: [teacherId], references: [id])
  
  grades    Grade[]

  @@index([teacherId])
  @@index([code])
}

model Grade {
  id        String   @id @default(cuid())
  score     Float
  maxScore  Float    @default(100)
  grade     String   // A, B, C...
  feedback  String?  @db.Text
  
  studentId String
  student   StudentProfile @relation(fields: [studentId], references: [id], onDelete: Cascade)
  
  subjectId String
  subject   Subject @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([studentId, subjectId]) // One grade per subject per student (or remove if multiple assessments)
  @@index([studentId])
  @@index([subjectId])
}

model Announcement {
  id        String   @id @default(cuid())
  title     String
  content   String   @db.Text
  date      DateTime @default(now())
  priority  String   @default("normal") // high, normal, low
  
  authorId  String
  author    User     @relation("PostedBy", fields: [authorId], references: [id])

  @@index([authorId])
}
